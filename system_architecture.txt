┌───┬──────────────────────────────────────────────────────────────────────┐
│1  │┌──────────────────────────┐                                          │
│2  ││        USER / ADMIN      │                                          │
│3  ││  (GUI / API / CLI)       │                                          │
│4  │└─────────────┬────────────┘                                          │
│5  │              │                                                       │
│6  │              ▼                                                       │
│7  │┌──────────────────────────┐                                          │
│8  ││     INTEGRATION LAYER    │                                          │
│9  ││ (Controller / Backend)  │                                           │
│10 │└─────────────┬────────────┘                                          │
│11 │              │                                                       │
│12 │              │  Rule Management                                      │
│13 │              │───────────────────────────────────────────────┐       │
│14 │              ▼                                               │       │
│15 │┌──────────────────────────┐                                  │       │
│16 ││ Simulator/rule_addition  │                                  │       │
│17 ││ - Create rules           │                                  │       │
│18 ││ - Validate rules         │                                  │       │
│19 ││ - Set action             │                                  │       │
│20 ││ - Set position(optional) │                                  │       │
│21 │└─────────────┬────────────┘                                  │       │
│22 │              ▼                                               │       │
│23 │┌──────────────────────────┐                                  │       │
│24 ││   Simulator/schema       │                                  │       │
│25 ││ - Rule schema            │                                  │       │
│26 ││ - Validation             │                                  │       │
│27 │└─────────────┬────────────┘                                  │       │
│28 │              │                                               │       │
│29 │              │                                               │       │
│30 │              │                                               │       │
│31 │              │  ─────────────────────────────────────────────┘       │
│32 │              │                                                       │
│33 │              │                                                       │
│34 │              ▼                                                       │
│35 │════════════════════════════════════════════════════════════════════  │
│36 │                TRAFFIC INGESTION (TWO ENTRY PATHS)                   │
│37 │════════════════════════════════════════════════════════════════════  │
│38 │                                                                      │
│39 │              ┌───────────────────────────────┐                       │
│40 │              │                               │                       │
│41 │              ▼                               ▼                       │
│42 │                                                                      │
│43 │┌──────────────────────────┐        ┌─────────────────────────────┐   │
│44 ││ Simulator/pcap_analysis  │        │ Simulator/topology_simulation│  │
│45 ││ (REAL TRAFFIC REPLAY)    │        │ (SYNTHETIC TRAFFIC)          │  │
│46 ││ - Parse PCAP             │        │ - Generate packets           │  │
│47 ││ - Normalize packets      │        │ - Attacker → FW → Target     │  │
│48 ││ - Build timeline         │        │                              │  │
│49 │└─────────────┬────────────┘        └──────────────┬──────────────┘   │
│50 │              │                                    │                  │
│51 │              └──────────────┬─────────────────────┘                  │
│52 │                             ▼                                        │
│53 │════════════════════════════════════════════════════════════════════  │
│54 │                      FIREWALL CORE ENGINE                            │
│55 │════════════════════════════════════════════════════════════════════  │
│56 │                                                                      │
│57 │┌──────────────────────────┐                                          │
│58 ││ Simulator/rule_implementation │                                     │
│59 ││ - Ordered rule evaluation │                                         │
│60 ││ - Match conditions        │                                         │
│61 ││ - Apply action            │                                         │
│62 ││   • ALLOW → stop          │                                         │
│63 ││   • DENY  → stop + log    │                                         │
│64 ││   • ALERT → log + continue│                                         │
│65 │└─────────────┬────────────┘                                          │
│66 │              ▼                                                       │
│67 │┌──────────────────────────┐                                          │
│68 ││   Simulator/schema       │                                          │
│69 ││ - Detection objects      │                                          │
│70 ││ - Packet + Rule context  │                                          │
│71 │└─────────────┬────────────┘                                          │
│72 │              ▼                                                       │
│73 │════════════════════════════════════════════════════════════════════  │
│74 │                     SIMULATION OUTPUT                                │
│75 │════════════════════════════════════════════════════════════════════  │
│76 │                                                                      │
│77 │┌─────────────────────────────────────────────────────────────┐       │
│78 ││ Simulation Result Object                                    │       │
│79 ││ ─────────────────────────────────────────────────────────── │       │
│80 ││ • summary (ALLOW / DENY / ALERT counts)                     │       │
│81 ││ • timeline (packet-by-packet decisions)                     │       │
│82 ││ • detections (rule hits)                                    │       │
│83 │└─────────────┬───────────────────────────────────────────────┘       │
│84 │              │                                                       │
│85 │              ▼                                                       │
│86 │════════════════════════════════════════════════════════════════════  │
│87 │                  POST-ATTACK INTELLIGENCE                            │
│88 │════════════════════════════════════════════════════════════════════  │
│89 │                                                                      │
│90 │┌──────────────────────────┐                                          │
│91 ││ Simulator/post_attack_analysis │                                    │
│92 ││ - Correlate detections    │                                         │
│93 ││ - Identify top targets    │                                         │
│94 ││ - Severity distribution  │                                          │
│95 ││ - Critical timeline      │                                          │
│96 ││ - Final assessment text  │                                          │
│97 │└─────────────┬────────────┘                                          │
│98 │              ▼                                                       │
│99 │════════════════════════════════════════════════════════════════════  │
│100│               POLICY & RULE INTELLIGENCE (SIDE BRANCHES)             │
│101│════════════════════════════════════════════════════════════════════  │
│102│                                                                      │
│103│        ┌──────────────────────────────┐                              │
│104│        │                              │                              │
│105│        ▼                              ▼                              │
│106│                                                                      │
│107│┌──────────────────────────┐   ┌──────────────────────────────┐       │
│108││ Simulator/policy_order_analyzer │   │ Simulator/rule_effectiveness ││
│109││ - Shadowed rules          │   │ - Rule hit count               │    │
│110││ - ALLOW before DENY      │   │ - Dead rules                   │     │
│111││ - Overlapping rules      │   │ - Noisy rules                  │     │
│112││ - Reorder suggestions    │   │ - Effectiveness classification │     │
│113│└─────────────┬────────────┘   └──────────────┬───────────────┘       │
│114│              │                               │                       │
│115│              └──────────────┬────────────────┘                       │
│116│                             ▼                                        │
│117│════════════════════════════════════════════════════════════════════  │
│118│                  FINAL CONSUMPTION LAYER                             │
│119│════════════════════════════════════════════════════════════════════  │
│120│                                                                      │
│121│┌─────────────────────────────────────────────────────────────┐       │
│122││ Integration Layer / GUI / API                                │      │
│123││ ─────────────────────────────────────────────────────────── │       │
│124││ • Dashboards                                                 │      │
│125││ • Timeline visualisation                                     │      │
│126││ • Policy health view                                         │      │
│127││ • Rule tuning UI                                             │      │
│128││ • (Future) Report export trigger                             │      │
│129│└─────────────────────────────────────────────────────────────┘       │
└───┴──────────────────────────────────────────────────────────────────────┘
